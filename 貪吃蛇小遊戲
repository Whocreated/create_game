import pygame
import random
from enum import Enum

class Direction(Enum):
    UP = (0, -1)
    DOWN = (0, 1)
    LEFT = (-1, 0)
    RIGHT = (1, 0)

pygame.init()

# 設置
WINDOW_WIDTH = 640
WINDOW_HEIGHT = 480
GRID_SIZE = 20
FPS = 10

# 顏色
BLACK = (0, 0, 0)
GREEN = (0, 255, 0)
RED = (255, 0, 0)
WHITE = (255, 255, 255)

screen = pygame.display.set_mode((WINDOW_WIDTH, WINDOW_HEIGHT))
pygame.display.set_caption("貪吃蛇")
clock = pygame.time.Clock()

# 初始化蛇和食物
snake = [(WINDOW_WIDTH // 2, WINDOW_HEIGHT // 2)]
direction = Direction.RIGHT
food = (random.randint(0, WINDOW_WIDTH // GRID_SIZE - 1) * GRID_SIZE,
        random.randint(0, WINDOW_HEIGHT // GRID_SIZE - 1) * GRID_SIZE)

running = True
game_over = False

while running:
    clock.tick(FPS)
    
    for event in pygame.event.get():
        if event.type == pygame.QUIT:
            running = False
        if event.type == pygame.KEYDOWN:
            if event.key == pygame.K_UP and direction != Direction.DOWN:
                direction = Direction.UP
            elif event.key == pygame.K_DOWN and direction != Direction.UP:
                direction = Direction.DOWN
            elif event.key == pygame.K_LEFT and direction != Direction.RIGHT:
                direction = Direction.LEFT
            elif event.key == pygame.K_RIGHT and direction != Direction.LEFT:
                direction = Direction.RIGHT
    
    if not game_over:
        # 移動蛇
        head_x, head_y = snake[0]
        dx, dy = direction.value
        new_head = (head_x + dx * GRID_SIZE, head_y + dy * GRID_SIZE)
        
        # 檢查撞牆或自撞
        if (new_head[0] < 0 or new_head[0] >= WINDOW_WIDTH or
            new_head[1] < 0 or new_head[1] >= WINDOW_HEIGHT or
            new_head in snake):
            game_over = True
        else:
            snake.insert(0, new_head)
            
            # 檢查吃到食物
            if new_head == food:
                food = (random.randint(0, WINDOW_WIDTH // GRID_SIZE - 1) * GRID_SIZE,
                        random.randint(0, WINDOW_HEIGHT // GRID_SIZE - 1) * GRID_SIZE)
            else:
                snake.pop()
    
    # 繪製
    screen.fill(BLACK)
    
    # 繪製蛇
    for segment in snake:
        pygame.draw.rect(screen, GREEN, (*segment, GRID_SIZE, GRID_SIZE))
    
    # 繪製食物
    pygame.draw.rect(screen, RED, (*food, GRID_SIZE, GRID_SIZE))
    
    # 繪製 Game Over 文字
    if game_over:
        font = pygame.font.Font(None, 36)
        text = font.render("Game Over!", True, WHITE)
        screen.blit(text, (WINDOW_WIDTH // 2 - 80, WINDOW_HEIGHT // 2))
    
    pygame.display.flip()

pygame.quit()
